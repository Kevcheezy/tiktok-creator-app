# R1.5.10 Visual Script Breakdown — Backend Completion Design

**Date:** 2026-02-15
**Status:** Approved
**Role:** Backend

## Goal

Complete the 2 remaining backend items for R1.5.10:
1. Auto-tag script segments with props needed and interaction type
2. Camera/shot specs as structured, editable fields

## Approach

**LLM-generated tags at script time (Approach A):** Extend the ScriptingAgent's LLM output format to include 3 new fields per segment. Zero additional API cost — piggybacks on existing script generation call.

## Data Model

3 new columns on `scene` table:

| Column | Type | Default | Description |
|--------|------|---------|-------------|
| `props_needed` | `jsonb` | `[]` | Array of strings: props the segment requires |
| `interaction_type` | `text` | `null` | How the creator interacts with the product |
| `camera_specs` | `jsonb` | `null` | `{ angle, movement, lighting }` structured object |

### Enum Values

**interaction_type:** `hold_and_show`, `apply_to_skin`, `stir_mix`, `demonstrate`, `pour_drink`, `unbox`, `compare`, `try_on`, `set_down_point`, `none`

**camera_specs.angle:** `close-up`, `medium`, `wide`, `over-shoulder`

**camera_specs.movement:** `static`, `slow_zoom_in`, `slow_zoom_out`, `pan_left`, `pan_right`, `tracking`

**camera_specs.lighting:** `ring_light_front`, `natural_window`, `warm_ambient`, `dramatic_side`, `soft_diffused`

## Changes

### ScriptingAgent
- Extend LLM output format to include `props_needed`, `interaction_type`, `camera_specs` per segment
- Save to scene rows in both `run()` and `analyzeUploadedScript()` paths
- Add to `regenerateSegment()` output and scene insert

### Segment PATCH Endpoint
- Add `props_needed`, `interaction_type`, `camera_specs` as editable fields
- Validate enum values server-side

### CastingAgent
- Feed `camera_specs` from scene into visual prompt generation
- Use angle, movement, lighting in keyframe prompts

### Files Affected
- `src/agents/scripting-agent.ts` — LLM prompt + scene insert
- `src/agents/casting-agent.ts` — visual prompt enrichment
- `src/app/api/projects/[id]/scripts/[scriptId]/segments/[segmentIndex]/route.ts` — PATCH validation
- Supabase migration — 3 new columns on scene table
